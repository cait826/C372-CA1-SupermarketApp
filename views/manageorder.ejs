<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Orders</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
      :root {
        --brand: #0d6efd;
        --muted: #6c757d;
        --card-radius: 12px;
      }

      body {
        background-color: lightblue;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        color: #0b2540;
      }

      /* Top nav (visual only) */
      .topbar {
        background: linear-gradient(180deg,#08192b,#0b233f);
        color: #fff;
        box-shadow: 0 6px 24px rgba(11,35,64,0.12);
      }
      .topbar .navbar-brand { font-weight:700; letter-spacing:.3px; }
      .topbar .nav-link { color: rgba(255,255,255,0.85); }

      .page-head {
        padding: 1.25rem 0;
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:1rem;
      }
      .page-title { font-size:1.35rem; font-weight:700; }
      .page-sub { color: var(--muted); font-size:.95rem; }

      .card-wrap {
        background: #fff;
        border-radius: var(--card-radius);
        padding: 1rem;
        box-shadow: 0 10px 30px rgba(16,24,40,0.06);
      }

      /* Table styles */
      .orders-table {
        width:100%;
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid rgba(13,110,253,0.06);
        background: #fff;
      }
      .orders-table thead th {
        background: linear-gradient(180deg,#f8fbff,#eef6ff);
        font-weight:700;
        color:#0b2540;
        border-bottom: 1px solid rgba(13,110,253,0.06);
        vertical-align: middle;
      }
      .orders-table tbody tr { transition: background .12s ease, transform .12s ease; }
      .orders-table tbody tr:hover { background: #fbfdff; transform: translateY(-2px); box-shadow: 0 8px 24px rgba(16,24,40,0.04); }

      .order-id { font-weight:700; }
      .order-meta { color:var(--muted); font-size:.9rem; }

      /* Status badge styles */
      .badge-status { padding:.36em .6em; border-radius:.6rem; font-weight:600; font-size:.85rem; display:inline-block; }
      .badge-pending { background:#fff3cd; color:#856404; }
      .badge-inprogress { background:#e7f4ff; color:#0b63bf; }
      .badge-completed { background:#d1f7e4; color:#0b7a43; }

      /* Enhanced actions */
      .btn-view {
        background: #fff;
        border:1px solid rgba(13,110,253,0.08);
        color: var(--brand);
      }
      .btn-save {
        background: #0d6efd;
        color: #fff;
        border: none;
      }
      .btn-save[disabled] { opacity: .65; }

      /* Small screens */
      @media (max-width: 767.98px) {
        .desktop-only { display:none !important; }
        .mobile-stack { gap:.5rem; flex-direction:column; }
        .orders-table thead { display: none; }
        .orders-table tbody td { display: block; text-align: left; padding: .75rem 1rem; }
        .orders-table tbody tr { margin-bottom: 0.75rem; border-radius: .75rem; background: #fff; box-shadow: 0 6px 18px rgba(16,24,40,0.04); }
      }

      .sticky-headers thead th { position: sticky; top: 0; z-index: 1; }
    </style>
</head>

<body>
  <nav class="navbar navbar-expand-sm topbar">
    <div class="container-fluid">
      <a class="navbar-brand text-white" href="/">Supermarket App</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu" aria-controls="navMenu" aria-expanded="false">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-3">
          <li class="nav-item"><a class="nav-link" href="/inventory">View Inventory</a></li>
          <li class="nav-item"><a class="nav-link" href="/addProduct">Add Product</a></li>
          <li class="nav-item"><a class="nav-link" href="/manageuser">Manage Users</a></li>
          <li class="nav-item"><a class="nav-link active" href="/manageOrders">Manage Orders</a></li>
          <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <div class="page-head">
      <div>
        <div class="page-title"><i class="bi bi-clipboard-check me-2"></i>Manage Orders</div>
        <div class="page-sub">Review, update status, and view order details</div>
      </div>

      <div class="desktop-only d-flex gap-2 align-items-center">
        <a href="/manageOrders" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-clockwise"></i> Refresh</a>
        <a href="/" class="btn btn-primary btn-sm"><i class="bi bi-speedometer2 me-1"></i> Dashboard</a>
      </div>
    </div>

    <div class="card-wrap">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <strong>Orders</strong>
          <div class="order-meta">Total orders: <strong><%= orders && orders.length ? orders.length : 0 %></strong></div>
        </div>

        <div class="d-flex gap-2 align-items-center">
          <!-- Visual search (preserve potential original search form if added elsewhere) -->
          <form class="d-flex" action="/manageOrders" method="GET" role="search">
            <input class="form-control form-control-sm me-2" type="search" name="q" placeholder="Search orders..." value="<%= typeof q !== 'undefined' ? q : '' %>">
            <button class="btn btn-sm btn-outline-primary" type="submit"><i class="bi bi-search"></i></button>
          </form>
        </div>
      </div>

      <% if (orders && orders.length > 0) { %>
        <div class="table-responsive">
          <table class="table orders-table align-middle mb-0 sticky-headers">
            <thead class="table-head">
              <tr>
                <th class="text-start">Order ID</th>
                <th>Username</th>
                <th>Date</th>
                <th>Total Price</th>
                <th class="text-center">Status</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>

            <tbody>
              <% orders.forEach(order => { %>
                <tr>
                  <form action="/manageOrders/<%= order.id %>/status" method="POST">
                    <td class="text-start">
                      <div class="order-id">#<%= order.id %></div>
                      <div class="order-meta desktop-only">Order date: <%= order.order_date.toLocaleString() %></div>
                    </td>

                    <td>
                      <div><%= order.username %></div>
                      <div class="order-meta desktop-only"><%= order.user_email || '' %></div>
                    </td>

                    <td class="desktop-only">
                      <div class="order-meta"><%= order.order_date.toLocaleString() %></div>
                    </td>

                    <td>
                      $<%= order.total_price %>
                    </td>

                    <td class="text-center">
                      <div class="d-flex justify-content-center align-items-center gap-2">
                        <select name="status" class="form-select form-select-sm" <%= order.status === "Completed" ? "disabled" : "" %>>
                            <option value="Pending" <%= order.status === "Pending" ? "selected" : "" %>>Pending</option>
                            <option value="In-Progress" <%= order.status === "In-Progress" ? "selected" : "" %>>In-Progress</option>
                            <option value="Completed" <%= order.status === "Completed" ? "selected" : "" %>>Completed</option>
                        </select>

                        <% if (order.status === "Pending") { %>
                          <span class="badge-status badge-pending">Pending</span>
                        <% } else if (order.status === "In-Progress") { %>
                          <span class="badge-status badge-inprogress">In-Progress</span>
                        <% } else { %>
                          <span class="badge-status badge-completed">Completed</span>
                        <% } %>
                      </div>
                    </td>

                    <td class="text-end">
                      <div class="d-flex justify-content-end gap-2 align-items-center mobile-stack">
                        <a href="/manageOrders/<%= order.id %>" class="btn btn-view btn-sm">
                          <i class="bi bi-eye-fill me-1"></i> View
                        </a>

                        <button type="submit" class="btn btn-save btn-sm" <%= order.status === "Completed" ? "disabled" : "" %>> 
                          <i class="bi bi-save-fill me-1"></i> Save
                        </button>
                      </div>
                    </td>
                  </form>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="text-center py-4">
          <p class="text-muted mb-3">No orders found.</p>
        </div>
      <% } %>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <%- include("./partials/footer") %>
</body>
</html>

